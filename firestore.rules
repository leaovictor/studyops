rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Goals: user owns docs
    match /goals/{docId} {
      allow get: if request.auth != null && resource.data.userId == request.auth.uid;
      allow list: if request.auth != null;
      allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;
      allow update, delete: if request.auth != null && resource.data.userId == request.auth.uid;
    }

    // Subjects: user owns docs
    match /subjects/{docId} {
      allow get: if request.auth != null && resource.data.userId == request.auth.uid;
      allow list: if request.auth != null;
      allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;
      allow update, delete: if request.auth != null && resource.data.userId == request.auth.uid;
    }

    // Topics: authenticated users can read/write (no direct userId field)
    match /topics/{docId} {
      allow read, write: if request.auth != null;
    }

    // Study plans: user owns docs
    match /study_plans/{docId} {
      allow get: if request.auth != null && resource.data.userId == request.auth.uid;
      allow list: if request.auth != null;
      allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;
      allow update, delete: if request.auth != null && resource.data.userId == request.auth.uid;
    }

    // Daily tasks: user owns docs
    match /daily_tasks/{docId} {
      allow get: if request.auth != null && resource.data.userId == request.auth.uid;
      allow list: if request.auth != null;
      allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;
      allow update, delete: if request.auth != null && resource.data.userId == request.auth.uid;
    }

    // Study logs: user owns docs
    match /study_logs/{docId} {
      allow get: if request.auth != null && resource.data.userId == request.auth.uid;
      allow list: if request.auth != null;
      allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;
      allow update, delete: if request.auth != null && resource.data.userId == request.auth.uid;
    }

    // Error notes: user owns docs
    match /error_notebook/{docId} {
      allow get: if request.auth != null && resource.data.userId == request.auth.uid;
      allow list: if request.auth != null;
      allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;
      allow update, delete: if request.auth != null && resource.data.userId == request.auth.uid;
    }

    // Flashcards: user owns docs
    match /flashcards/{docId} {
      allow get: if request.auth != null && resource.data.userId == request.auth.uid;
      allow list: if request.auth != null;
      allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;
      allow update, delete: if request.auth != null && resource.data.userId == request.auth.uid;
    }

    // Pomodoro Settings: user owns docs, docId is userId
    match /pomodoro_settings/{docId} {
      allow read, write: if request.auth != null && docId == request.auth.uid;
    }

    // FSRS Review Logs: authenticated users can read/write
    match /fsrs_review_logs/{docId} {
      allow read, write: if request.auth != null;
    }
  }
}
